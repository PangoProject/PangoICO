/**
 * [Chart.PieceLabel.js]{@link https://github.com/emn178/Chart.PieceLabel.js}
 *
 * @version 0.7.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2017
 * @license MIT
 */
(function(){function p(){this.drawDataset=this.drawDataset.bind(this)}p.prototype.beforeDatasetsUpdate=function(a){if(this.parseOptions(a)&&"outside"===this.position){var b=1.5*this.fontSize+2;a.chartArea.top+=b;a.chartArea.bottom-=b}};p.prototype.afterDatasetsDraw=function(a){this.parseOptions(a)&&(this.labelBounds=[],a.config.data.datasets.forEach(this.drawDataset))};p.prototype.drawDataset=function(a){for(var b,d=this.ctx,m=this.chartInstance,f=a._meta[Object.keys(a._meta)[0]],k=0,l=0;l<f.data.length;l++){var g=
    f.data[l],c=g._view;if(0!==c.circumference||this.showZero){switch(this.render){case "value":var h=a.data[l];this.format&&(h=this.format(h));h=h.toString();break;case "label":h=m.config.data.labels[l];break;default:b=c.circumference/this.options.circumference*100,b=parseFloat(b.toFixed(this.precision)),k+=b,100<k&&(b-=k-100,b=parseFloat(b.toFixed(this.precision))),h=b+"%"}"function"===typeof this.render&&(h=this.render({label:m.config.data.labels[l],value:a.data[l],percentage:b}));d.save();d.beginPath();
    d.font=Chart.helpers.fontString(this.fontSize,this.fontStyle,this.fontFamily);if("outside"===this.position||"border"===this.position&&"pie"===m.config.type){var e=c.outerRadius/2;var p,q=this.fontSize+2;var n=c.startAngle+(c.endAngle-c.startAngle)/2;"border"===this.position?p=(c.outerRadius-e)/2+e:"outside"===this.position&&(p=c.outerRadius-e+e+q);n={x:c.x+Math.cos(n)*p,y:c.y+Math.sin(n)*p};if("outside"===this.position){n.x=n.x<c.x?n.x-q:n.x+q;var r=c.outerRadius+q}}else e=c.innerRadius,n=g.tooltipPosition();
    q=this.fontColor;"string"!==typeof this.fontColor&&(q=this.fontColor[l]||this.options.defaultFontColor);if(this.arc)r||(r=(e+c.outerRadius)/2),d.fillStyle=q,d.textBaseline="middle",this.drawArcText(h,r,c,this.overlap);else{e=d.measureText(h);c=n.x-e.width/2;e=n.x+e.width/2;var t=n.y-this.fontSize/2,u=n.y+this.fontSize/2;if(this.overlap||("outside"===this.position?this.checkTextBound(c,e,t,u):g.inRange(c,t)&&g.inRange(c,u)&&g.inRange(e,t)&&g.inRange(e,u)))d.fillStyle=q,d.textBaseline="top",d.textAlign=
        "center",d.fillText(h,n.x,n.y-this.fontSize/2)}d.restore()}}};p.prototype.parseOptions=function(a){var b=a.options.pieceLabel;return b?(this.chartInstance=a,this.ctx=a.chart.ctx,this.options=a.config.options,this.render=b.render||b.mode,this.position=b.position||"default",this.arc=b.arc,this.format=b.format,this.precision=b.precision||0,this.fontSize=b.fontSize||this.options.defaultFontSize,this.fontColor=b.fontColor||this.options.defaultFontColor,this.fontStyle=b.fontStyle||this.options.defaultFontStyle,
    this.fontFamily=b.fontFamily||this.options.defaultFontFamily,this.hasTooltip=a.tooltip._active&&a.tooltip._active.length,this.showZero=b.showZero,this.overlap=b.overlap,!0):!1};p.prototype.checkTextBound=function(a,b,d,m){for(var f,k,l=this.labelBounds,g=0;g<l.length;++g){for(var c=l[g],h=[[a,d],[a,m],[b,d],[b,m]],e=0;e<h.length;++e)if(k=h[e][0],f=h[e][1],k>=c.left&&k<=c.right&&f>=c.top&&f<=c.bottom)return!1;h=[[c.left,c.top],[c.left,c.bottom],[c.right,c.top],[c.right,c.bottom]];for(e=0;e<h.length;++e)if(k=
        h[e][0],f=h[e][1],k>=a&&k<=b&&f>=d&&f<=m)return!1}l.push({left:a,right:b,top:d,bottom:m});return!0};p.prototype.drawArcText=function(a,b,d,m){var f=this.ctx,k=d.x,l=d.y,g=d.startAngle;d=d.endAngle;f.save();f.translate(k,l);l=d-g;g+=Math.PI/2;d+=Math.PI/2;k=f.measureText(a);g+=(d-(k.width/b+g))/2;if(m||!(d-g>l))for(f.rotate(g),m=0;m<a.length;m++)g=a.charAt(m),k=f.measureText(g),f.save(),f.translate(0,-1*b),f.fillText(g,0,0),f.restore(),f.rotate(k.width/b);f.restore()};Chart.pluginService.register({beforeInit:function(a){a.pieceLabel=
    new p},beforeDatasetsUpdate:function(a){a.pieceLabel.beforeDatasetsUpdate(a)},afterDatasetsDraw:function(a){a.pieceLabel.afterDatasetsDraw(a)}})})();